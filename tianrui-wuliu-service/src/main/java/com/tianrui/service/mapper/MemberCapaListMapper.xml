<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tianrui.service.mapper.MemberCapaMapper" >
  <select id="selectByCondition" resultType="com.tianrui.service.bean.MemberCapaList" 
  		parameterType="com.tianrui.service.bean.MemberCapa" >
  SELECT
	vd.id id,
	vd.drivername drivername,
	vd.drivertel drivertel,
	vd.vehicleTypeName vehicleType,
	f.username username,
	f.telphone telphone,
	f.companyname companyname,
	f.companytel companytel,
	v.vehilength length,
	v.vehiweight weight,
	v.vehicleprefix vehfix,
	v.vehicleno vehno,
	v.billstatus billstatus,
	(-1) status
	FROM
		wuliu_vehicle_driver vd
		LEFT JOIN member_info f ON f.id = vd.creator
		LEFT JOIN wuliu_member_vehicle v ON v.id = vd.vehicleid 
	<where>
    	<if test="memberid != null and memberid != ''">
    		and vd.creator = #{memberid,jdbcType=VARCHAR}
    	</if>
    	<if test="vehicleid != null and vehicleid != ''">
    		and vd.vehicleid = #{vehicleid,jdbcType=VARCHAR}
    	</if>
    </where>
	UNION ALL
	SELECT
		c.id id,
		d.drivername drivername,
		d.drivertel drivertel,
		v.vehicletypename vehicletype,
	  	f.username username,
		f.telphone telphone,
		f.companyname companyname,
		f.companytel companytel,
		v.vehilength length,
		v.vehiweight weight,
		v.vehicleprefix vehfix,
		v.vehicleno vehno,
		v.billstatus billstatus,
		c.status status
	FROM
		wuliu_member_capa c
		LEFT JOIN wuliu_member_vehicle v ON c.vehicleid = v.id
		LEFT JOIN member_info f ON f.id = c.ownerid
		LEFT JOIN wuliu_vehicle_driver d ON c.vehicleid = d.vehicleid
  	<where>
    	<if test="memberid != null and memberid != ''">
    		and c.memberid = #{memberid,jdbcType=VARCHAR}
    	</if>
    	<if test="vehicleid != null and vehicleid != ''">
    		and c.vehicleid = #{vehicleid,jdbcType=VARCHAR}
    	</if>
    </where>
   	<if test="start != null and start != '0'">
    	<if test="limit !=null" >
     		limit #{start,jdbcType=INTEGER},#{limit,jdbcType=INTEGER}
    	</if>
   	</if> 
  </select>
  <select id="selectByVDCount" resultType="long" 
  		parameterType="com.tianrui.service.bean.MemberCapa" >
    SELECT
	count(*)
	FROM
		wuliu_vehicle_driver vd
		LEFT JOIN member_info f ON f.id = vd.creator
		LEFT JOIN wuliu_member_vehicle v ON v.id = vd.vehicleid 
	<where>
    	<if test="memberid != null and memberid != ''">
    		and vd.creator = #{memberid,jdbcType=VARCHAR}
    	</if>
    	<if test="vehicleid != null and vehicleid != ''">
    		and vd.vehicleid = #{vehicleid,jdbcType=VARCHAR}
    	</if>
    </where>
  </select>
  <select id="selectByMCCount" resultType="long" 
  		parameterType="com.tianrui.service.bean.MemberCapa" >
	SELECT
		count(*)
	FROM
		wuliu_member_capa c
		LEFT JOIN wuliu_member_vehicle v ON c.vehicleid = v.id
		LEFT JOIN member_info f ON f.id = c.ownerid
		LEFT JOIN wuliu_vehicle_driver d ON c.vehicleid = d.vehicleid
  	<where>
    	<if test="memberid != null and memberid != ''">
    		and c.memberid = #{memberid,jdbcType=VARCHAR}
    	</if>
    	<if test="vehicleid != null and vehicleid != ''">
    		and c.vehicleid = #{vehicleid,jdbcType=VARCHAR}
    	</if>
    </where>
  </select>
  <select id="selectByCreateBill" resultType="com.tianrui.service.bean.MemberCapaList" 
  		parameterType="com.tianrui.service.bean.MemberCapa" >
	SELECT
		c.id id,
		d.drivername drivername,
		d.drivertel drivertel,
		v.vehicletypename vehicletype,
	  	f.username username,
		f.telphone telphone,
		f.companyname companyname,
		f.companytel companytel,
		v.vehilength length,
		v.vehiweight weight,
		v.vehicleprefix vehfix,
		v.vehicleno vehno,
		v.billstatus billstatus,
		c.status status
	FROM
		wuliu_member_capa c
		LEFT JOIN wuliu_member_vehicle v ON c.vehicleid = v.id
		LEFT JOIN member_info f ON f.id = c.ownerid
		LEFT JOIN wuliu_vehicle_driver d ON c.vehicleid = d.vehicleid
  	<where>
    	<if test="memberid != null and memberid != ''">
    		and c.memberid = #{memberid,jdbcType=VARCHAR}
    		and d.vehicleid IS NOT NULL
    		and c.status = 1
    	</if>
    	<if test="vehicleid != null and vehicleid != ''">
    		and c.vehicleid = #{vehicleid,jdbcType=VARCHAR}
    	</if>
    </where>
  </select>
</mapper>
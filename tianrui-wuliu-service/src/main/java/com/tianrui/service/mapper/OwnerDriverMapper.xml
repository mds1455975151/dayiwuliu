<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tianrui.service.mapper.OwnerDriverMapper" >
  <resultMap id="BaseResultMap" type="com.tianrui.service.bean.OwnerDriver" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="vehicleownerid" property="vehicleownerid" jdbcType="VARCHAR" />
    <result column="driverid" property="driverid" jdbcType="VARCHAR" />
    <result column="drivername" property="drivername" jdbcType="VARCHAR" />
    <result column="drivertel" property="drivertel" jdbcType="VARCHAR" />
    <result column="remarkname" property="remarkname" jdbcType="VARCHAR" />
    <result column="count" property="count" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="creator" property="creator" jdbcType="VARCHAR" />
    <result column="createtime" property="createtime" jdbcType="BIGINT" />
  </resultMap>
  
  <!-- 人工代码 ，包含车辆与司机表内容 -->
  <resultMap id="VehiDriverResultMap" type="com.tianrui.service.bean.VehicleAndDriver" >
  	<!-- 我的车辆表 -->
    <result column="vehiid" property="vehiid" jdbcType="VARCHAR" />
    <result column="vehiprefix" property="vehiprefix" jdbcType="VARCHAR" />
    <result column="vehino" property="vehino" jdbcType="VARCHAR" />
    <result column="vehitype" property="vehitype" jdbcType="VARCHAR" />
    <result column="vehitypename" property="vehitypename" jdbcType="VARCHAR" />
    <result column="vehilength" property="vehilength" jdbcType="DOUBLE" />
    <result column="vehiweight" property="vehiweight" jdbcType="DOUBLE" />
    <result column="vehiheadimgpath" property="vehiheadimgpath" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="memo" property="memo" jdbcType="VARCHAR" />
    <!-- 车辆与司机关系表 -->
    <result column="memberid" property="memberid" jdbcType="VARCHAR" />
    <result column="driverid" property="driverid" jdbcType="VARCHAR" />
    <result column="drivername" property="drivername" jdbcType="VARCHAR" />
    <result column="drivertel" property="drivertel" jdbcType="VARCHAR" />
    <!-- 会员信息表 -->
    <result column="identityCard" property="identityCard" jdbcType="VARCHAR" />
  </resultMap>
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, vehicleownerid, driverid, drivername, drivertel, remarkname, status, creator, createtime
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from wuliu_owner_driver
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from wuliu_owner_driver
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.tianrui.service.bean.OwnerDriver" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into wuliu_owner_driver (id, vehicleownerid, driverid, 
      drivername, drivertel, remarkname, status,
      creator, createtime)
    values (#{id,jdbcType=VARCHAR}, #{vehicleownerid,jdbcType=VARCHAR}, #{driverid,jdbcType=VARCHAR}, 
      #{drivername,jdbcType=VARCHAR}, #{drivertel,jdbcType=VARCHAR}, #{remarkname,jdbcType=VARCHAR}, 
      #{status,jdbcType=VARCHAR}, #{creator,jdbcType=VARCHAR}, #{createtime,jdbcType=BIGINT})
  </insert>
  <insert id="insertSelective" parameterType="com.tianrui.service.bean.OwnerDriver" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into wuliu_owner_driver
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="vehicleownerid != null" >
        vehicleownerid,
      </if>
      <if test="driverid != null" >
        driverid,
      </if>
      <if test="drivername != null" >
        drivername,
      </if>
      <if test="drivertel != null" >
        drivertel,
      </if>
      <if test="remarkname != null" >
        remarkname,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="creator != null" >
        creator,
      </if>
      <if test="createtime != null" >
        createtime,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="vehicleownerid != null" >
        #{vehicleownerid,jdbcType=VARCHAR},
      </if>
      <if test="driverid != null" >
        #{driverid,jdbcType=VARCHAR},
      </if>
      <if test="drivername != null" >
        #{drivername,jdbcType=VARCHAR},
      </if>
      <if test="drivertel != null" >
        #{drivertel,jdbcType=VARCHAR},
      </if>
      <if test="remarkname != null" >
        #{remarkname,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        #{creator,jdbcType=VARCHAR},
      </if>
      <if test="createtime != null" >
        #{createtime,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.tianrui.service.bean.OwnerDriver" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update wuliu_owner_driver
    <set >
      <if test="vehicleownerid != null" >
        vehicleownerid = #{vehicleownerid,jdbcType=VARCHAR},
      </if>
      <if test="driverid != null" >
        driverid = #{driverid,jdbcType=VARCHAR},
      </if>
      <if test="drivername != null" >
        drivername = #{drivername,jdbcType=VARCHAR},
      </if>
      <if test="drivertel != null" >
        drivertel = #{drivertel,jdbcType=VARCHAR},
      </if>
      <if test="remarkname != null" >
        remarkname = #{remarkname,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        creator = #{creator,jdbcType=VARCHAR},
      </if>
      <if test="createtime != null" >
        createtime = #{createtime,jdbcType=BIGINT},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.tianrui.service.bean.OwnerDriver" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update wuliu_owner_driver
    set vehicleownerid = #{vehicleownerid,jdbcType=VARCHAR},
      driverid = #{driverid,jdbcType=VARCHAR},
      drivername = #{drivername,jdbcType=VARCHAR},
      drivertel = #{drivertel,jdbcType=VARCHAR},
      remarkname = #{remarkname,jdbcType=VARCHAR},
      status = #{status,jdbcType=VARCHAR},
      creator = #{creator,jdbcType=VARCHAR},
      createtime = #{createtime,jdbcType=BIGINT}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <select id="findByVehOwnerIds" resultMap="BaseResultMap" parameterType="java.lang.String">
  	 select 
    <include refid="Base_Column_List" />
    from wuliu_owner_driver
    where vehicleownerid = #{id,jdbcType=VARCHAR}
  </select>
  
  <!-- 根据条件进行我的未绑定车辆的司机信息查询 -->
  <select id="selectMyDriverOutsideByCondition" resultMap="BaseResultMap" parameterType="com.tianrui.service.bean.OwnerDriver" >
    SELECT 
           A.id AS id, A.driverid AS driverid, A.drivername AS drivername, 
           A.drivertel AS drivertel, A.remarkname AS remarkname, A.status AS status,
           A.creator AS creator, A.createtime AS createtime
      FROM wuliu_owner_driver A
     WHERE A.vehicleownerid = #{vehicleownerid,jdbcType=VARCHAR}
           <if test="status != null and status != ''" >
           	 AND A.status = #{status,jdbcType=VARCHAR}
      	   </if>
      	   <if test="status == null or status == ''" >
           	 AND A.status = '1'
      	   </if>
           <if test="drivername != null and drivername != ''" >
           	 AND drivername = #{drivername,jdbcType=VARCHAR}
      	   </if>
	       <if test="drivertel != null and drivertel != ''" >
	         AND drivertel = #{drivertel,jdbcType=VARCHAR}
	       </if>
           AND NOT EXISTS (SELECT B.driverid 
           					 FROM wuliu_vehicle_driver B 
                            WHERE B.driverid = A.driverid
                                  AND B.creator = A.vehicleownerid)
  </select>
  
  <!-- 根据条件进行我的司机信息查询 -->
  <select id="selectMyDriverByCondition" resultMap="BaseResultMap" parameterType="com.tianrui.service.bean.OwnerDriver" >
    select 
    	od.id id, od.vehicleownerid vehicleownerid, od.driverid driverid,
     	od.drivername drivername, od.drivertel drivertel,
    	 od.remarkname remarkname, od.status status, od.creator creator, od.createtime createtime,
	    (SELECT
				count(*)
			FROM
				wuliu_vehicle_driver vd  WHERE vd.driverid = od.driverid AND vd.creator = od.creator
		) AS count
      from wuliu_owner_driver od
   	<where>
   	  <if test="id != null and id != ''" >
        and od.id = #{id,jdbcType=VARCHAR}
      </if>
       <if test="search != null and search != ''">
      	and (od.drivername like "%"#{search,jdbcType=VARCHAR}"%" or od.drivertel like "%"#{search,jdbcType=VARCHAR}"%")
      </if>
       <if test="vehicleownerid != null and vehicleownerid != ''" >
        and od.vehicleownerid = #{vehicleownerid,jdbcType=VARCHAR}
      </if>
      <if test="driverid != null and driverid != ''" >
        and od.driverid = #{driverid,jdbcType=VARCHAR}
      </if>
      <if test="drivername != null and drivername != ''" >
        and od.drivername like "%" #{drivername,jdbcType=VARCHAR}"%"
      </if>
      <if test="drivertel != null and drivertel != ''" >
        and od.drivertel like "%" #{drivertel,jdbcType=VARCHAR}"%"
      </if>
      <if test="remarkname != null and remarkname != ''" >
        and od.remarkname = #{remarkname,jdbcType=VARCHAR}
      </if>
      <if test="status != null and status != ''" >
        and od.status = #{status,jdbcType=VARCHAR}
      </if>
      <if test="creator != null and creator != ''" >
        and od.creator = #{creator,jdbcType=VARCHAR}
      </if>
      <if test="createtime != null and createtime != ''" >
        and od.createtime = #{createtime,jdbcType=BIGINT}
      </if>
      ORDER BY count
   	</where>
   	  <if test="start != null and start != 0 and limit != null">
	    limit #{start,jdbcType=INTEGER},#{limit,jdbcType=INTEGER}
      </if>
      <if test="start == 0 and limit != null">
	    limit #{limit,jdbcType=INTEGER}
      </if>
  </select>
  
  <!-- 根据条件进行我的司机数据总数查询 -->
  <select id="selectCountByCondition" resultType="long" parameterType="com.tianrui.service.bean.OwnerDriver" >
    select 
        count(*)
      from wuliu_owner_driver
   	<where>
   	  <if test="id != null and id != ''" >
        and id = #{id,jdbcType=VARCHAR}
      </if>
      <if test="search != null and search != ''">
      	and (drivername like "%"#{search,jdbcType=VARCHAR}"%" or drivertel like "%"#{search,jdbcType=VARCHAR}"%")
      </if>
       <if test="vehicleownerid != null and vehicleownerid != ''" >
        and vehicleownerid = #{vehicleownerid,jdbcType=VARCHAR}
      </if>
      <if test="driverid != null and driverid != ''" >
        and driverid = #{driverid,jdbcType=VARCHAR}
      </if>
      <if test="drivername != null and drivername != ''" >
        and drivername like "%" #{drivername,jdbcType=VARCHAR} "%"
      </if>
      <if test="drivertel != null and drivertel != ''" >
        and drivertel like "%" #{drivertel,jdbcType=VARCHAR} "%"
      </if>
      <if test="remarkname != null and remarkname != ''" >
        and remarkname = #{remarkname,jdbcType=VARCHAR}
      </if>
      <if test="status != null and status != ''" >
        and status = #{status,jdbcType=VARCHAR}
      </if>
      <if test="creator != null and creator != ''" >
        and creator = #{creator,jdbcType=VARCHAR}
      </if>
      <if test="createtime != null and createtime != ''" >
        and createtime = #{createtime,jdbcType=BIGINT}
      </if>
   	</where>
  </select>
  
  <!-- 根据条件进行我的司机车辆信息联合查询 -->
  <select id="selectDriverAndVehicleByCondition" resultMap="VehiDriverResultMap" parameterType="com.tianrui.service.bean.VehicleAndDriver" >
	SELECT 
           e.vehicleownerid AS memberid, e.driverid, e.drivername, e.drivertel, c.identityCard,
           a.vehicleid AS vehiid, a.vehicleprefix AS vehiprefix, a.vehicleno AS vehino, a.vehicletype AS vehitype,
           a.vehicletypename AS vehitypename, a.vehilength, a.vehiweight, a.vehiheadimgpath, a.status, a.memo
           
      FROM wuliu_owner_driver e
           JOIN wuliu_memberInfo c
           		ON e.driverid = c.memberid
           JOIN wuliu_member d
           		ON c.memberid = d.id
           		   AND c.submitdate = d.submitdate
           LEFT JOIN  wuliu_vehicle_driver b
			ON b.creator = e.vehicleownerid
			   AND b.driverid = e.driverid
           LEFT JOIN  wuliu_member_vehicle a 
           		ON a.memberid = b.creator
           		   AND a.vehicleid = b.vehicleid
   	<where>
   	  <if test="memberid != null and memberid != ''" >
        and e.vehicleownerid = #{memberid,jdbcType=VARCHAR}
      </if>
      <if test="drivername != null and drivername != ''" >
        and e.drivername like "%" #{drivername,jdbcType=VARCHAR} "%"
      </if>
      <if test="drivertel != null and drivertel != ''" >
        and e.drivertel like "%" #{drivertel,jdbcType=VARCHAR} "%"
      </if>
      <if test="vehiprefix != null and vehiprefix != ''" >
        and a.vehicleprefix like "%" #{vehiprefix,jdbcType=VARCHAR} "%"
      </if>
      <if test="vehino != null and vehino != ''" >
        and a.vehicleno like "%" #{vehino,jdbcType=VARCHAR} "%"
      </if>
      <if test="vehitype != null and vehitype != ''" >
        and a.vehicletype = #{vehitype,jdbcType=VARCHAR}
      </if>
      <if test="vehilength != null and vehilength != ''" >
        and a.vehilength like "%" #{vehilength,jdbcType=DOUBLE} "%"
      </if>
   	</where>
  </select>
  
</mapper>